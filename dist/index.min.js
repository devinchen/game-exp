function Animal(){this.x=0,this.y=0,this.vx=2*Math.random(),this.vy=2*Math.random(),this.scale=0,this.texture="",this.textureSize=animalSize,this.isStop=!1,this.isShow=!1}function getTextures(){return["src/images/0.png","src/images/1.png","src/images/2.png","src/images/3.png","src/images/4.png","src/images/5.png","src/images/6.png","src/images/7.png","src/images/8.png","src/images/9.png","src/images/10.png","src/images/11.png"]}function onTouchStart(t){var e=[],i=t.targetTouches[0].pageX-t.target.offsetLeft,n=t.targetTouches[0].pageY-t.target.offsetTop;animals.length>0&&animals.forEach(function(t,s){t.isOnHit(i,n)&&e.push(s)}),e.length>0&&(targetAnimalIndex=e.pop(),offsetPosition.x=i-animals[targetAnimalIndex].x,offsetPosition.y=n-animals[targetAnimalIndex].y,canvas.addEventListener("touchmove",onTouchMove))}function onTouchMove(t){var e=animals[targetAnimalIndex],i=t.target,n=i.clientWidth,s=i.clientHeight,a=i.offsetLeft,o=i.offsetLeft+i.width,r=i.offsetTop,h=i.offsetTop+i.height,c=t.targetTouches[0].pageX,m=t.targetTouches[0].pageY;e.stop(),e.x=c-a-offsetPosition.x,e.y=m-r-offsetPosition.y,c>o-animalSize+offsetPosition.x&&(e.x=n-animalSize),c<a+offsetPosition.x&&(e.x=0),m>h-animalSize+offsetPosition.y&&(e.y=s-animalSize),m<r+offsetPosition.y&&(e.y=0)}function onTouchEnd(t){var e=animals[targetAnimalIndex];e&&e.resume(),targetAnimalIndex=-1,canvas.removeEventListener("touchmove",onTouchMove)}function getRandomPosition(t){var e=t.canvas.width,i=t.canvas.height,n=Math.round(e*Math.random()),s=Math.round(i*Math.random());return n>e-animalSize&&(n=e-animalSize),s>i-animalSize&&(s=i-animalSize),{x:n,y:s}}function isCheckPoint(){return timer.time%(countDownFrom/maxAnimals)===0}function generateAnimal(t){var e=getRandomPosition(context),i=new Animal;return i.setTexture(textures[t]),i.x=e.x,i.y=e.y,i}var Timer=function(){function t(){var t;return{font:"30px monospace",time:0,isStop:!1,start:function(){this.isStop||(t=setInterval(function(){this.time-=1,0===this.time&&this.stop()}.bind(this),1e3))},stop:function(){this.isStop=!0,clearInterval(t)},resume:function(){this.start()},draw:function(t){t.save(),t.font=this.font,t.fillText(this.time,10,40),t.restore()}}}var e;return{getInstance:function(){return e||(e=t()),e}}}();Animal.prototype.show=function(){this.isShow||(this.scale<1?this.scale+=.1:this.isShow=!0)},Animal.prototype.move=function(){var t=context.canvas.width,e=context.canvas.height;this.isStop||((this.y>e-this.textureSize||this.y<0)&&(this.vy*=-1),(this.x>t-this.textureSize||this.x<0)&&(this.vx*=-1),this.x+=this.vx,this.y+=this.vy)},Animal.prototype.stop=function(){this.isStop=!0},Animal.prototype.resume=function(){this.isStop=!1},Animal.prototype.setTexture=function(t){var e=new Image;e.src=t,this.texture=e},Animal.prototype.draw=function(t){t.save(),t.translate(this.x,this.y),t.scale(this.scale,this.scale),t.drawImage(this.texture,0,0,this.textureSize,this.textureSize),t.restore()},Animal.prototype.isOnHit=function(t,e){return t>this.x&&t<this.x+this.textureSize&&e>this.y&&e<this.y+this.textureSize};var offsetPosition={x:0,y:0},targetAnimalIndex=-1,canvas=document.getElementById("farm"),context=canvas.getContext("2d"),maxAnimals=12,countDownFrom=12,timer=Timer.getInstance(),textures=getTextures(),animals=[],animalSize=40,index=0,observer;observer=setInterval(function(){isCheckPoint()&&maxAnimals>index&&(animals.push(generateAnimal(index)),index++),timer.isStop&&clearInterval(observer)},1e3),timer.time=countDownFrom,timer.start(),canvas.addEventListener("touchstart",onTouchStart),canvas.addEventListener("touchend",onTouchEnd),function t(){window.requestAnimationFrame(t,canvas),context.clearRect(0,0,canvas.width,canvas.height),animals.forEach(function(t,e){t.show(),t.move(),t.draw(context)}),timer.draw(context)}();