function Farm(t){return this.canvas=t,this.context={},this.init()}function Animal(){this.x=0,this.y=0,this.vx=2*Math.random(),this.vy=2*Math.random(),this.scale=0,this.texture="",this.textureSize=animalSize,this.isStop=!1,this.isShow=!1}function getTextures(){return["src/images/0.png","src/images/1.png","src/images/2.png","src/images/3.png","src/images/4.png","src/images/5.png","src/images/6.png","src/images/7.png","src/images/8.png","src/images/9.png","src/images/10.png","src/images/11.png"]}function onRotate(t){var e,i,n=farm.getSize();farm.setSize(),e=farm.getSize(),animalSize=calcAnimalSize(farm),i=e.width/n.width,animals.forEach(function(t){t.setPositionByRatio(i),t.setSize(animalSize)})}function onTouchStart(t){var e=[],i=t.targetTouches[0].pageX-t.target.offsetLeft,n=t.targetTouches[0].pageY-t.target.offsetTop;animals.length>0&&animals.forEach(function(t,a){t.isOnHit(i,n)&&e.push(a)}),e.length>0&&(targetAnimalIndex=e.pop(),offsetPosition.x=i-animals[targetAnimalIndex].x,offsetPosition.y=n-animals[targetAnimalIndex].y,farmDOM.addEventListener("touchmove",onTouchMove))}function onTouchMove(t){var e=animals[targetAnimalIndex],i=t.target,n=i.clientWidth,a=i.clientHeight,s=i.offsetLeft,o=i.offsetLeft+i.width,r=i.offsetTop,h=i.offsetTop+i.height,m=t.targetTouches[0].pageX,c=t.targetTouches[0].pageY;t.preventDefault(),e.stop(),e.x=m-s-offsetPosition.x,e.y=c-r-offsetPosition.y,m>o-animalSize+offsetPosition.x&&(e.x=n-animalSize),m<s+offsetPosition.x&&(e.x=0),c>h-animalSize+offsetPosition.y&&(e.y=a-animalSize),c<r+offsetPosition.y&&(e.y=0)}function onTouchEnd(t){var e=animals[targetAnimalIndex];e&&e.resume(),targetAnimalIndex=-1,farmDOM.removeEventListener("touchmove",onTouchMove)}function isCheckPoint(){return timer.time%(countDownFrom/maxAnimals)===0}function getRandomPosition(t){var e=t.getSize(),i=e.width,n=e.height,a=Math.round(i*Math.random()),s=Math.round(n*Math.random());return a>i-animalSize&&(a=i-animalSize),s>n-animalSize&&(s=n-animalSize),{x:a,y:s}}function calcAnimalSize(t){function e(t){return i>t?i:t}var i=30,n=10,a=t.getSize();return e(a.width>a.height?a.height/n:a.width/n)}function getScreenSize(){return{width:screen.width,height:screen.height}}function generateAnimal(t){var e=getRandomPosition(farm),i=new Animal;return i.setTexture(textures[t]),i.x=e.x,i.y=e.y,i}var Timer=function(){function t(){var t;return{fontSize:30,time:0,isStop:!1,start:function(){this.isStop||(t=setInterval(function(){this.time-=1,0===this.time&&this.stop()}.bind(this),1e3))},stop:function(){this.isStop=!0,clearInterval(t)},resume:function(){this.start()},draw:function(t){t.save(),t.font=this.fontSize+"px monospace",t.fillText(this.time,10,40),t.restore()}}}var e;return{getInstance:function(){return e||(e=t()),e}}}();Farm.prototype.init=function(){this.context=this.canvas.getContext("2d"),this.setSize()},Farm.prototype.setSize=function(){var t=getScreenSize(),e=t.width,i=t.height;e>i?(this.canvas.width=.7*e,this.canvas.height=3*this.canvas.width/4):(this.canvas.width=.8*e,this.canvas.height=3*this.canvas.width/4)},Farm.prototype.getSize=function(){return{width:this.canvas.clientWidth,height:this.canvas.clientHeight}},Animal.prototype.show=function(){this.isShow||(this.scale<=1?this.scale+=.1:this.isShow=!0)},Animal.prototype.move=function(){var t=farm.getSize();this.isStop||((this.y>t.height-this.textureSize||this.y<0)&&(this.vy*=-1),(this.x>t.width-this.textureSize||this.x<0)&&(this.vx*=-1),this.x+=this.vx,this.y+=this.vy)},Animal.prototype.stop=function(){this.isStop=!0},Animal.prototype.resume=function(){this.isStop=!1},Animal.prototype.setTexture=function(t){var e=new Image;e.src=t,this.texture=e},Animal.prototype.setPositionByRatio=function(t){t&&(this.x*=t,this.y*=t)},Animal.prototype.setSize=function(t){this.textureSize=t},Animal.prototype.draw=function(t){t.save(),t.translate(this.x,this.y),t.scale(this.scale,this.scale),t.drawImage(this.texture,0,0,this.textureSize,this.textureSize),t.restore()},Animal.prototype.isOnHit=function(t,e){return t>this.x&&t<this.x+this.textureSize&&e>this.y&&e<this.y+this.textureSize};var offsetPosition={x:0,y:0},targetAnimalIndex=-1,farm=new Farm(document.getElementById("farm")),farmDOM=farm.canvas,farmContext=farm.context,maxAnimals=12,countDownFrom=12,timer=Timer.getInstance(),textures=getTextures(),animals=[],animalSize=calcAnimalSize(farm),index=0,observer;observer=setInterval(function(){isCheckPoint()&&maxAnimals>index&&(animals.push(generateAnimal(index)),index++),timer.isStop&&clearInterval(observer)},1e3),timer.time=countDownFrom,timer.start(),farmDOM.addEventListener("touchstart",onTouchStart),farmDOM.addEventListener("touchend",onTouchEnd),window.addEventListener("orientationchange",onRotate),function t(){window.requestAnimationFrame(t,farmDOM),farm.context.clearRect(0,0,farmDOM.width,farmDOM.height),animals.forEach(function(t,e){t.show(),t.move(),t.draw(farmContext)}),timer.draw(farmContext)}();